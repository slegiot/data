services:
  # 1. The main Next.js Application
  - type: web
    name: silent-data-collector
    env: node
    buildCommand: npm install && npm run build
    startCommand: npm run start
    envVars:
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: ADMIN_UUID
        sync: false
      - key: CRON_SECRET
        sync: false
      - key: BROWSERLESS_WSS_URL
        sync: false

  # 2. Render Cron Job â€” triggers the scrape endpoint every hour
  - type: cron
    name: collector-scraper-cron
    runtime: image
    image:
      url: curlimages/curl:latest
    schedule: "0 * * * *"
    # REPLACE 'your-app-name' with your actual Render web service name once deployed
    startCommand: >-
      curl -X GET "https://your-app-name.onrender.com/api/cron/scrape"
      -H "Authorization: Bearer $CRON_SECRET"
    envVars:
      - key: CRON_SECRET
        sync: false
