services:
  # 1. The main Next.js Application
  - type: web
    name: silent-data-collector
    env: node
    buildCommand: npm install && npm run build
    startCommand: npm run start
    envVars:
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: ADMIN_UUID
        sync: false
      - key: CRON_SECRET
        sync: false
      - key: BROWSERLESS_WSS_URL
        # Points to the private browserless service via Render's internal network
        value: ws://browserless-chrome:3000

  # 2. Render Cron Job â€” triggers the scrape endpoint every hour
  - type: cron
    name: collector-scraper-cron
    runtime: image
    image:
      url: curlimages/curl:latest
    schedule: "0 * * * *"
    # REPLACE 'your-app-name' with your actual Render web service name once deployed
    startCommand: >-
      curl -X GET "https://your-app-name.onrender.com/api/cron/scrape"
      -H "Authorization: Bearer $CRON_SECRET"
    envVars:
      - key: CRON_SECRET
        sync: false

  # 3. Self-hosted Browserless Chrome (private Docker service)
  # Runs headless Chromium accessible via WebSocket on Render's internal network.
  - type: pserv
    name: browserless-chrome
    env: docker
    repo: https://github.com/browserless/browserless.git
    plan: starter
    envVars:
      - key: MAX_CONCURRENT_SESSIONS
        value: "5"
      - key: CONNECTION_TIMEOUT
        value: "60000"
      - key: TOKEN
        value: ""

