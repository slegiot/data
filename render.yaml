services:
  # 1. The main Next.js Application
  - type: web
    name: silent-data-collector
    env: node
    buildCommand: npm install && npm run build
    startCommand: npm run start
    envVars:
      - key: NEXT_PUBLIC_SUPABASE_URL
        sync: false
      - key: NEXT_PUBLIC_SUPABASE_ANON_KEY
        sync: false
      - key: SUPABASE_SERVICE_ROLE_KEY
        sync: false
      - key: ADMIN_UUID
        sync: false
      - key: CRON_SECRET
        sync: false
      - key: BROWSERLESS_WSS_URL
        # Points to the private browserless service via Render's internal network
        value: ws://browserless-chrome-zqge:10000


  # 3. Self-hosted Browserless Chrome (private Docker service)
  # Pulls a prebuilt headless Chromium image from Docker Hub.
  # Accessible via WebSocket on Render's internal network.
  - type: pserv
    name: browserless-chrome
    runtime: image
    image:
      url: docker.io/browserless/chrome:latest
    envVars:
      - key: MAX_CONCURRENT_SESSIONS
        value: "5"
      - key: CONNECTION_TIMEOUT
        value: "60000"
      - key: TOKEN
        value: ""

